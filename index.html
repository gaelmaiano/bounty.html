<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BountyAcademy - Labs Cybersec</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CSS STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
        .app-container { display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 16rem; background-color: #1e293b; border-right: 1px solid #334155; display: flex; flex-direction: column; z-index: 20; transition: transform 0.3s; }
        .sidebar-header { padding: 1.5rem; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #334155; }
        .sidebar-header h1 { font-size: 1.2rem; color: white; font-weight: bold; }
        
        /* XP Panel */
        .xp-panel { padding: 1rem; background: rgba(30, 41, 59, 0.5); margin: 1rem; border-radius: 0.5rem; border: 1px solid #475569; }
        .xp-bar-container { width: 100%; background: #334155; height: 0.5rem; border-radius: 10px; overflow: hidden; margin: 0.5rem 0; }
        .xp-bar { background: #10b981; height: 100%; width: 0%; transition: width 0.5s; }
        .xp-info { display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; }

        /* Navigation */
        .nav-section { flex: 1; overflow-y: auto; padding: 0.5rem 0; }
        .nav-btn { width: 100%; text-align: left; padding: 0.75rem 1.5rem; color: #94a3b8; background: none; border: none; border-left: 4px solid transparent; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px; }
        .nav-btn:hover, .nav-btn.active { color: #34d399; background: #1e293b; border-left-color: #10b981; }
        .module-progress { margin-left: auto; font-size: 0.7rem; color: #64748b; }

        /* Main Content */
        .main-content { flex: 1; overflow-y: auto; position: relative; }
        .content-area { padding: 2rem; max-width: 64rem; margin: 0 auto; }
        .mobile-header { display: none; padding: 1rem; background: #1e293b; justify-content: space-between; align-items: center; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: rgba(30, 41, 59, 0.7); padding: 1.5rem; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.05); }
        .module-card { background: #1e293b; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border: 1px solid #475569; }
        .module-card:hover { border-color: #10b981; transform: translateX(5px); transition: transform 0.2s; }

        /* Labs UI */
        .lab-container { background: #1e293b; border: 1px solid #475569; border-radius: 0.5rem; padding: 1.5rem; margin-top: 1rem; }
        .lab-browser { background: #f8fafc; border-radius: 0.5rem; overflow: hidden; color: #334155; font-family: sans-serif; border: 1px solid #cbd5e1; }
        .browser-bar { background: #e2e8f0; padding: 0.5rem; display: flex; align-items: center; gap: 0.5rem; border-bottom: 1px solid #cbd5e1; }
        .url-bar { background: white; padding: 0.2rem 0.5rem; border-radius: 4px; flex: 1; font-size: 0.8rem; color: #64748b; border: 1px solid #cbd5e1; }
        .browser-content { padding: 2rem; min-height: 200px; text-align: center; }
        
        /* Inputs & Buttons */
        .vulnerable-input { padding: 0.75rem; border: 2px solid #cbd5e1; border-radius: 4px; width: 70%; margin-right: 0.5rem; }
        .vulnerable-btn { padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .action-btn { width: 100%; padding: 1rem; background: #059669; color: white; border: none; border-radius: 0.5rem; cursor: pointer; margin-top: 1rem; }
        .action-btn:disabled { background: #334155; cursor: not-allowed; }

        /* Specific Lab Styles */
        .profile-card { border: 1px solid #cbd5e1; border-radius: 8px; padding: 20px; max-width: 400px; margin: 0 auto; background: white; text-align: left; }
        .xxe-output, .lfi-file-content { margin-top: 1.5rem; padding: 1rem; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 4px; text-align: left; min-height: 100px; font-family: monospace; white-space: pre-wrap; }
        .xxe-success { color: #10b981; font-weight: bold; }
        .shop-product-received { display: inline-block; background: #334155; padding: 0.5rem; margin: 0.2rem; border-radius: 4px; color: white; font-size: 0.8rem; }

        /* Toast & Alerts */
        .toast { position: fixed; bottom: 20px; right: 20px; background: #1e293b; border-left: 4px solid #10b981; color: white; padding: 15px 20px; border-radius: 4px; transform: translateX(150%); transition: transform 0.3s; z-index: 100; }
        .toast.show { transform: translateX(0); }
        .fake-alert-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 50; }
        .fake-alert-box { background: white; padding: 1.5rem; border-radius: 0.5rem; width: 300px; text-align: center; color: #0f172a; }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { position: fixed; transform: translateX(-100%); height: 100vh; width: 80%; }
            .sidebar.mobile-open { transform: translateX(0); }
            .mobile-header { display: flex; }
            .stats-grid { grid-template-columns: 1fr; }
            .vulnerable-input { width: 100%; margin-bottom: 0.5rem; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-bug" style="color:#10b981"></i>
                <h1>BountyAcademy</h1>
            </div>
            <div class="xp-panel">
                <div class="xp-info"><span>Niveau</span><span id="user-level">Novice</span></div>
                <div class="xp-bar-container"><div id="xp-bar" class="xp-bar"></div></div>
                <div class="xp-info"><span id="current-xp">0 XP</span><span>3000 XP</span></div>
            </div>
            <div class="nav-section" id="nav-buttons">
                </div>
        </nav>

        <main class="main-content">
            <div class="mobile-header">
                <span style="color:white; font-weight:bold;">BountyAcademy</span>
                <button onclick="toggleSidebar()" style="background:none; border:none; color:white; font-size:1.5rem;"><i class="fa-solid fa-bars"></i></button>
            </div>
            <div id="content-area" class="content-area"></div>
        </main>
    </div>

    <div id="toast" class="toast"><span id="toast-message"></span></div>
    <div id="fake-alert-overlay" class="fake-alert-overlay">
        <div class="fake-alert-box">
            <h3 style="color:#ef4444; margin-bottom:1rem;">⚠️ Alert</h3>
            <p id="alert-content" style="background:#f1f5f9; padding:0.5rem; font-family:monospace; margin-bottom:1rem;">1</p>
            <button class="vulnerable-btn" onclick="closeFakeAlert()">OK</button>
        </div>
    </div>

    <script>
        // --- ETAT DE L'APPLICATION ---
        const appState = {
            xp: 0,
            level: 1,
            completedModules: [],
            currentView: 'dashboard'
        };

        // --- DONNÉES DES MODULES ---
        const modulesData = [
            { id: 'xss', title: 'Lab 1: XSS Reflected', icon: 'code', color: '#10b981', xp: 200, level: 'Facile' },
            { id: 'idor', title: 'Lab 2: IDOR', icon: 'id-card', color: '#f59e0b', xp: 300, level: 'Moyen' },
            { id: 'sqli', title: 'Lab 3: SQL Injection', icon: 'database', color: '#ef4444', xp: 400, level: 'Intermédiaire' },
            { id: 'csrf', title: 'Lab 4: CSRF', icon: 'hand-pointer', color: '#3b82f6', xp: 400, level: 'Avancé' },
            { id: 'xxe', title: 'Lab 5: XXE', icon: 'file-code', color: '#fbbf24', xp: 500, level: 'Expert' },
            { id: 'rc', title: 'Lab 6: Race Condition', icon: 'gauge-high', color: '#ef4444', xp: 600, level: 'Expert+' },
            { id: 'lfi', title: 'Lab 7: LFI', icon: 'folder-open', color: '#34d399', xp: 600, level: 'Intermédiaire' }
        ];

        // --- RENDU DES VUES (HTML) ---
        const views = {
            dashboard: () => {
                let html = `
                    <h2 class="dashboard-title">Tableau de bord</h2>
                    <div class="stats-grid">
                        <div class="stat-card"><div style="color:#94a3b8">XP Total</div><div style="font-size:1.8rem; font-weight:bold; color:white;">${appState.xp}</div></div>
                        <div class="stat-card"><div style="color:#94a3b8">Labs Terminés</div><div style="font-size:1.8rem; font-weight:bold; color:white;">${appState.completedModules.length}/7</div></div>
                    </div>
                    <h3 style="color:white; margin-bottom:1rem;">Modules</h3>`;
                
                modulesData.forEach(m => {
                    html += `
                    <div class="module-card" onclick="navigateTo('module-${m.id}')">
                        <div style="display:flex; align-items:center; gap:1rem;">
                            <div style="width:3rem; height:3rem; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center; color:${m.color}"><i class="fa-solid fa-${m.icon}"></i></div>
                            <div><h4 style="color:white; margin:0;">${m.title}</h4><span style="font-size:0.8rem; color:#94a3b8;">${m.level} • ${m.xp} XP</span></div>
                        </div>
                        <i class="fa-solid fa-chevron-right" style="color:#475569"></i>
                    </div>`;
                });
                return html;
            },
            'module-xss': () => `
                ${getBackButton()}
                <h2 style="color:white; margin-bottom:1rem;">Lab 1: XSS Reflected</h2>
                <div class="lab-container">
                    <div style="margin-bottom:0.5rem; color:#94a3b8;">Mission: Faire apparaître une <code>alert(1)</code> via la recherche.</div>
                    <div class="lab-browser">
                        <div class="browser-bar"><div class="url-bar">/search</div></div>
                        <div class="browser-content">
                            <h3>Super Search</h3>
                            <input type="text" id="xss-input" class="vulnerable-input" placeholder="Rechercher...">
                            <button onclick="runXSS()" class="vulnerable-btn">Go</button>
                            <div id="xss-result" style="margin-top:1rem;"></div>
                        </div>
                    </div>
                </div>
                ${getValidateButton('xss')}
            `,
            'module-idor': () => `
                ${getBackButton()}
                <h2 style="color:white; margin-bottom:1rem;">Lab 2: IDOR</h2>
                <div class="lab-container">
                    <div style="margin-bottom:0.5rem; color:#94a3b8;">Mission: Accéder au profil ID 1234 (Admin). Votre ID est 1337.</div>
                    <div class="lab-browser">
                        <div class="browser
