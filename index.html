<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BountyAcademy - Labs XSS, IDOR, SQLi, CSRF, XXE, Race Condition & LFI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Base styles (Mobile-First approach, though layout is desktop-focused) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; height: 100vh; overflow-x: hidden; /* Added to prevent horizontal scrolling */ }
        .app-container { display: flex; height: 100vh; }
        .sidebar { width: 16rem; background-color: #1e293b; border-right: 1px solid #334155; display: flex; flex-direction: column; z-index: 20; transition: transform 0.3s; }
        
        /* ... Styles conservés pour le Header, XP Panel, Navigation ... */

        .sidebar-header { padding: 1.5rem; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #334155; }
        .sidebar-header i { color: #10b981; font-size: 1.5rem; }
        .sidebar-header h1 { font-size: 1.25rem; font-weight: bold; color: white; }
        .sidebar-header span { color: #10b981; }
        .xp-panel { padding: 1rem; background-color: rgba(30, 41, 59, 0.5); margin: 1rem; border-radius: 0.5rem; border: 1px solid #475569; }
        .xp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .xp-label { font-size: 0.75rem; color: #94a3b8; font-weight: bold; text-transform: uppercase; }
        .user-level { font-size: 0.75rem; background-color: rgba(16, 185, 129, 0.2); color: #34d399; padding: 0.25rem 0.5rem; border-radius: 0.25rem; }
        .xp-bar-container { width: 100%; background-color: #334155; height: 0.5rem; border-radius: 9999px; overflow: hidden; }
        .xp-bar { background-color: #10b981; height: 100%; transition: width 0.5s; }
        .xp-info { display: flex; justify-content: space-between; margin-top: 0.25rem; font-size: 0.75rem; color: #94a3b8; }
        .nav-section { flex: 1; overflow-y: auto; padding: 0.5rem 0; }
        .nav-btn { width: 100%; text-align: left; padding: 0.75rem 1.5rem; color: #94a3b8; background: none; border: none; border-left: 4px solid transparent; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; transition: all 0.15s; position: relative; }
        .nav-btn:hover, .nav-btn.active { color: #34d399; background-color: #1e293b; border-left-color: #10b981; }
        .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .sidebar-footer { padding: 1rem; text-align: center; font-size: 0.75rem; color: #475569; border-top: 1px solid #334155; }
        .main-content { flex: 1; overflow-y: auto; background-color: #0f172a; position: relative; }
        .content-area { padding: 2rem; max-width: 64rem; margin: 0 auto; min-height: 100%; }
        .dashboard-title { font-size: 1.875rem; font-weight: bold; margin-bottom: 1.5rem; }
        .stat-card { background: rgba(30, 41, 59, 0.7); padding: 1.5rem; border-radius: 0.5rem; border: 1px solid rgba(255, 255, 255, 0.05); }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .module-card { background-color: #1e293b; padding: 1rem; border-radius: 0.5rem; border: 1px solid #475569; margin-bottom: 1rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: transform 0.2s; }
        .module-card:hover { border-color: #10b981; transform: translateX(5px); }
        .action-btn { width: 100%; padding: 1rem; background-color: #059669; color: white; border: none; border-radius: 0.5rem; cursor: pointer; margin-top: 1rem; font-size: 1rem; transition: background 0.2s; }
        .action-btn:hover { background-color: #047857; }
        .action-btn:disabled { background-color: #334155; cursor: not-allowed; }
        .back-btn { background:none; border:none; color: #94a3b8; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; font-size: 1rem; }
        .back-btn:hover { color: #10b981; }
        
        /* Progress indicators */
        .module-progress { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem; padding: 0 1.5rem; }
        .progress-bar { flex: 1; height: 4px; background: #334155; border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: #10b981; transition: width 0.3s ease; }
        .progress-text { font-size: 0.7rem; color: #64748b; min-width: 2rem; }
        
        /* Labs Containers */
        .lab-container { background-color: #1e293b; border: 1px solid #475569; border-radius: 0.5rem; padding: 1.5rem; margin-top: 1rem; }
        .lab-browser { background-color: #f8fafc; border-radius: 0.5rem; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); color: #334155; font-family: 'Segoe UI', sans-serif; border: 1px solid #cbd5e1; }
        .browser-bar { background-color: #e2e8f0; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; border-bottom: 1px solid #cbd5e1; }
        .browser-dots { display: flex; gap: 0.25rem; }
        .dot { width: 0.75rem; height: 0.75rem; border-radius: 50%; }
        .dot-red { background-color: #ef4444; }
        .dot-yellow { background-color: #f59e0b; }
        .dot-green { background-color: #10b981; }
        .url-bar { background-color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; flex: 1; font-size: 0.8rem; color: #64748b; margin-left: 1rem; border: 1px solid #cbd5e1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .browser-content { padding: 2rem; min-height: 250px; text-align: center; position: relative; }
        
        /* Inputs & Buttons Labs - ADJUSTED FOR MOBILE WRAPPING */
        /* IMPORTANT: Added flex-wrap to handle input/button on small screens */
        .search-form-container { display: flex; justify-content: center; gap:0.5rem; flex-wrap: wrap; } 
        .vulnerable-input { padding: 0.75rem; border: 2px solid #cbd5e1; border-radius: 0.25rem; width: 70%; margin-right: 0.5rem; font-size: 1rem; outline: none; }
        .vulnerable-input:focus { border-color: #3b82f6; }
        .vulnerable-btn { padding: 0.75rem 1.5rem; background-color: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 1rem; transition: background 0.2s; }
        .vulnerable-btn:hover { background-color: #2563eb; }
        .search-result { margin-top: 2rem; padding: 1rem; border: 1px dashed #94a3b8; background-color: #f1f5f9; border-radius: 0.25rem; display: none; text-align: left; max-width: 80%; margin-left: auto; margin-right: auto; }
        
        /* ... Autres styles conservés ... */

        /* IDOR Styles */
        .profile-card { border: 1px solid #cbd5e1; border-radius: 8px; padding: 20px; max-width: 400px; margin: 0 auto; background: white; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .profile-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; }
        .profile-avatar { width: 60px; height: 60px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #64748b; }
        .profile-details p { margin-bottom: 8px; font-size: 0.9rem; }
        .profile-label { font-weight: bold; color: #475569; width: 80px; display: inline-block; }
        .api-key { background: #fee2e2; color: #991b1b; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 0.85rem; }
        .idor-control { margin-top: 20px; padding: 15px; background: #f1f5f9; border-radius: 8px; display: inline-flex; align-items: center; gap: 10px; }
        
        /* SQLi/CSRF Styles */
        .login-box { max-width: 350px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .login-input { width: 100%; padding: 10px; margin-bottom: 1rem; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 1rem; }
        .sql-debug { margin-top: 20px; font-family: monospace; font-size: 0.85rem; background: #1e293b; color: #10b981; padding: 10px; border-radius: 4px; text-align: left; border-left: 3px solid #10b981; min-height: 3.5em; display: flex; align-items: center; }

        /* CSRF Styles */
        .csrf-panel { max-width: 500px; margin: 0 auto; }
        .csrf-target { background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; text-align: left; color: #334155; }
        .csrf-attacker { background: #fee2e2; padding: 1rem; border-radius: 8px; border: 1px solid #fca5a5; margin-top: 1rem; text-align: left; color: #991b1b; }
        .csrf-payload { width: 100%; height: 80px; font-family: monospace; font-size: 0.85rem; padding: 5px; border: 1px solid #fca5a5; margin-top: 0.5rem; resize: vertical; }
        
        /* XXE Styles */
        .xxe-input { width: 100%; height: 150px; font-family: monospace; font-size: 0.9rem; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; resize: vertical; }
        .xxe-output { margin-top: 1.5rem; padding: 1rem; border: 1px solid #e2e8f0; background: #f1f5f9; border-radius: 4px; text-align: left; min-height: 100px; color: #334155; overflow: auto; }
        .xxe-error { color:#ef4444; font-weight:bold; }
        .xxe-success { color:#10b981; font-weight:bold; }

        /* Race Condition Styles */
        .shop-mission-box { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 10px; padding: 1.5rem; margin: 1rem 0; }
        .shop-product-card { background: #1e293b; border-radius: 12px; padding: 2rem; border: 1px solid #334155; max-width: 400px; margin: 0 auto 2rem; }
        .shop-product-image { width: 100%; height: 150px; background: linear-gradient(45deg, #334155, #475569); border-radius: 8px; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: #94a3b8; }
        .shop-product-price { color: #10b981; font-size: 2rem; font-weight: bold; margin: 1rem 0; }
        .shop-cart-summary { background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 10px; padding: 1.5rem; margin: 2rem auto; max-width: 500px; text-align: center; }
        .shop-cart-value { font-size: 2rem; font-weight: bold; color: #fbbf24; margin: 0.5rem 0; }
        .shop-amount-paid { font-size: 2rem; font-weight: bold; color: #10b981; margin: 0.5rem 0; }
        .shop-savings { font-size: 1.5rem; font-weight: bold; color: #ef4444; margin: 0.5rem 0; }
        .shop-attack-panel { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 12px; padding: 1.5rem; margin-top: 2rem; max-width: 500px; margin-left: auto; margin-right: auto; }
        .shop-logs { background: #0f172a; border-radius: 8px; padding: 1.5rem; margin-top: 2rem; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9rem; }
        .shop-products-received { display: flex; justify-content: center; gap: 1rem; margin: 1rem 0; flex-wrap: wrap; }
        .shop-product-received { background: #334155; padding: 1rem; border-radius: 8px; text-align: center; min-width: 80px; border: 2px solid #475569; }
        .shop-product-free { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        
        /* LFI Styles (New) */
        .lfi-file-content {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: left;
            min-height: 100px;
            color: #334155;
            overflow: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }

        /* Tutorial and hints */
        .tutorial-box { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .tutorial-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; color: #3b82f6; }
        .hint-btn { background: none; border: 1px solid #64748b; color: #64748b; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-left: 0.5rem; }
        .hint-btn:hover { background: #334155; }
        .hint-content { margin-top: 0.5rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.5); border-radius: 4px; font-size: 0.9rem; display: none; }
        
        /* Feedback Elements */
        .fake-alert-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 50; backdrop-filter: blur(2px); }
        .fake-alert-box { background: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); width: 320px; text-align: center; color: #0f172a; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .alert-btn { margin-top: 1rem; background: #3b82f6; color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 0.25rem; cursor: pointer; }
        .toast { position: fixed; bottom: 20px; right: 20px; background: #1e293b; border-left: 4px solid #10b981; color: white; padding: 15px 20px; border-radius: 4px; transform: translateX(150%); transition: transform 0.3s; z-index: 100; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); display: flex; align-items: center; gap: 10px; }
        .toast.show { transform: translateX(0); }
        
        .mobile-header { display: none; }

        /* Mobile Adjustments (Max 768px) */
        @media (max-width: 768px) {
            .app-container { overflow-y: auto; /* Permet le défilement du contenu principal */ }
            .content-area { padding: 1rem; /* Réduit le padding sur mobile */ }
            .stats-grid { grid-template-columns: 1fr; }
            
            .sidebar { 
                position: fixed; 
                transform: translateX(-100%); 
                height: 100vh; 
                width: 70%; /* Rendre la sidebar plus petite sur mobile */
                max-width: 300px;
                box-shadow: 2px 0 5px rgba(0,0,0,0.5);
            }
            .sidebar.mobile-open { 
                transform: translateX(0); 
            }
            
            .main-content {
                width: 100%; /* Le contenu principal prend toute la largeur */
            }

            .mobile-header { 
                display: flex; 
                padding: 1rem; 
                background: #1e293b; 
                justify-content: space-between; 
                align-items: center; 
                border-bottom: 1px solid #334155;
                position: sticky; /* Garde l'en-tête visible lors du défilement */
                top: 0;
                z-index: 10;
            }
            .mobile-menu-btn { 
                background: none; 
                border: none; 
                color: white; 
                font-size: 1.5rem; 
                cursor: pointer; 
            }
            
            /* Formulaire XSS - Ajustement pour l'empilement */
            .search-form-container {
                flex-direction: column; /* Empile les éléments du formulaire */
            }
            .vulnerable-input { 
                width: 100%; 
                margin-right: 0; 
                margin-bottom: 0.5rem; /* Ajoute de l'espace entre l'input et le bouton */
            }
            .vulnerable-btn { 
                width: 100%; 
            }

            /* Réduit la taille des cartes */
            .profile-card { max-width: 100%; }
            .login-box { max-width: 100%; }
            .csrf-panel { max-width: 100%; }
            
            /* Les conteneurs lab et tutoriels prennent toute la largeur */
            .lab-container, .tutorial-box { margin-left: 0; margin-right: 0; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <i class="fa-solid fa-bug"></i>
                <h1>Bounty<span>Acad</span></h1>
            </div>
            <div class="xp-panel">
                <div class="xp-header">
                    <span class="xp-label">Rang</span>
                    <span id="user-level" class="user-level">Novice</span>
                </div>
                <div class="xp-bar-container">
                    <div id="xp-bar" class="xp-bar" style="width: 0%"></div>
                </div>
                <div class="xp-info">
                    <span id="current-xp">0 XP</span>
                    <span id="next-level-xp">3000 XP (Max)</span>
                </div>
            </div>
            <div class="nav-section">
                <button class="nav-btn active" onclick="navigateTo('dashboard')" data-view="dashboard">
                    <i class="fa-solid fa-chart-line"></i> Dashboard
                </button>
                <div style="padding: 1rem; font-size: 0.75rem; color: #64748b; font-weight: bold;">MODULES PRATIQUES</div>
                <button class="nav-btn" onclick="navigateTo('module-xss')" data-view="module-xss">
                    <i class="fa-solid fa-code"></i> Lab 1: XSS Reflected
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-xss" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-xss" class="progress-text">0%</span>
                    </div>
                </button>
                <button class="nav-btn" onclick="navigateTo('module-idor')" data-view="module-idor">
                    <i class="fa-solid fa-id-card"></i> Lab 2: IDOR
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-idor" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-idor" class="progress-text">0%</span>
                    </div>
                </button>
                <button class="nav-btn" onclick="navigateTo('module-sqli')" data-view="module-sqli">
                    <i class="fa-solid fa-database"></i> Lab 3: SQL Injection
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-sqli" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-sqli" class="progress-text">0%</span>
                    </div>
                </button>
                <button class="nav-btn" onclick="navigateTo('module-csrf')" data-view="module-csrf">
                    <i class="fa-solid fa-hand-pointer"></i> Lab 4: CSRF
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-csrf" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-csrf" class="progress-text">0%</span>
                    </div>
                </button>
                <button class="nav-btn" onclick="navigateTo('module-xxe')" data-view="module-xxe">
                    <i class="fa-solid fa-file-code"></i> Lab 5: XXE
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-xxe" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-xxe" class="progress-text">0%</span>
                    </div>
                </button>
                <button class="nav-btn" onclick="navigateTo('module-race-condition')" data-view="module-race-condition">
                    <i class="fa-solid fa-gauge-high"></i> Lab 6: Race Condition
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-rc" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-rc" class="progress-text">0%</span>
                    </div>
                </button>
                   <button class="nav-btn" onclick="navigateTo('module-lfi')" data-view="module-lfi">
                    <i class="fa-solid fa-folder-open"></i> Lab 7: LFI
                    <div class="module-progress">
                        <div class="progress-bar">
                            <div id="progress-lfi" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <span id="progress-text-lfi" class="progress-text">0%</span>
                    </div>
                </button>
            </div>
            <div class="sidebar-footer">v1.9 | Ajout Lab LFI</div>
        </nav>

        <main class="main-content">
            <div class="mobile-header">
                <span style="font-weight: bold; color:white;">BountyAcademy</span>
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>
            
            <div id="content-area" class="content-area"></div>
        </main>
    </div>

    <div id="toast" class="toast">
        <i class="fa-solid fa-check-circle" style="color:#34d399"></i> <span id="toast-message">Succès !</span>
    </div>

    <div id="fake-alert-overlay" class="fake-alert-overlay">
        <div class="fake-alert-box">
            <h3 style="margin-bottom: 0.5rem; color: #ef4444; display:flex; align-items:center; justify-content:center; gap:0.5rem;">
                <i class="fa-solid fa-triangle-exclamation"></i> Alert
            </h3>
            <p style="margin-bottom: 1rem; color:#334155;">Le site indique :</p>
            <p id="alert-content" style="font-family: monospace; font-size:1.2rem; font-weight:bold; background: #f1f5f9; padding: 0.5rem; margin-bottom: 1rem; border-radius: 4px; border:1px solid #cbd5e1;">1</p>
            <button class="alert-btn" onclick="closeFakeAlert()">OK</button>
        </div>
    </div>

    <script>
        // --- Code JavaScript (Ajout de la fonction toggleSidebar) ---

        var appState = {
            xp: 0,
            level: 1,
            completedModules: [],
            currentView: 'dashboard'
        };

        var modules = {
            dashboard: {
                render: function() {
                    var html = '';
                    html += '<h2 class="dashboard-title">Tableau de bord</h2>';
                    html += '<div class="stats-grid">';
                    html += '<div class="stat-card">';
                    html += '<div style="color: #94a3b8; font-size: 0.875rem;">XP Total</div>';
                    html += '<div style="font-size: 1.875rem; font-weight: bold; color: white;">' + appState.xp + '</div>';
                    html += '</div>';
                    html += '<div class="stat-card">';
                    html += '<div style="color: #94a3b8; font-size: 0.875rem;">Modules Terminés</div>';
                    html += '<div style="font-size: 1.875rem; font-weight: bold; color: white;">' + appState.completedModules.length + '/7</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '<h3 style="color:white; margin-bottom:1rem;">Continuer l\'apprentissage</h3>';
                    
                    // CARTE XSS
                    html += '<div class="module-card" onclick="navigateTo(\'module-xss\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #10b981;">';
                    html += '<i class="fa-solid fa-code"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 1: XSS Reflected</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Facile • 200 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';
                    
                    // CARTE IDOR
                    html += '<div class="module-card" onclick="navigateTo(\'module-idor\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #f59e0b;">';
                    html += '<i class="fa-solid fa-id-card"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 2: IDOR</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Moyen • 300 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';

                    // CARTE SQLI
                    html += '<div class="module-card" onclick="navigateTo(\'module-sqli\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #ef4444;">';
                    html += '<i class="fa-solid fa-database"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 3: SQL Injection</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Intermédiaire • 400 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';

                    // CARTE CSRF
                    html += '<div class="module-card" onclick="navigateTo(\'module-csrf\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #3b82f6;">';
                    html += '<i class="fa-solid fa-hand-pointer"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 4: CSRF (Request Forgery)</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Avancé • 400 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';
                    
                    // CARTE XXE
                    html += '<div class="module-card" onclick="navigateTo(\'module-xxe\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #fbbf24;">';
                    html += '<i class="fa-solid fa-file-code"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 5: XXE (External Entity)</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Expert • 500 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';

                    // CARTE RACE CONDITION
                    html += '<div class="module-card" onclick="navigateTo(\'module-race-condition\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #ef4444;">';
                    html += '<i class="fa-solid fa-gauge-high"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 6: Race Condition</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Expert+ • 600 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';
                    
                    // CARTE LFI (NEW)
                    html += '<div class="module-card" onclick="navigateTo(\'module-lfi\')">';
                    html += '<div style="display:flex; align-items:center; gap:1rem;">';
                    html += '<div style="width: 3rem; height: 3rem; background: #334155; border-radius: 50%; display:flex; align-items:center; justify-content:center; color: #34d399;">';
                    html += '<i class="fa-solid fa-folder-open"></i>';
                    html += '</div>';
                    html += '<div>';
                    html += '<h4 style="color: white; font-weight: bold;">Lab 7: LFI (Local File Inclusion)</h4>';
                    html += '<p style="font-size: 0.75rem; color: #94a3b8;">Niveau: Intermédiaire • 600 XP</p>';
                    html += '</div>';
                    html += '</div>';
                    html += '<i class="fa-solid fa-chevron-right" style="color: #475569;"></i>';
                    html += '</div>';

                    return html;
                }
            },
            'module-xss': {
                xpReward: 200,
                render: function() {
                    var isDone = appState.completedModules.indexOf('module-xss') !== -1;
                    var html = '';
                    html += '<button onclick="navigateTo(\'dashboard\')" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Retour</button>';
                    html += '<h2 class="dashboard-title"><i class="fa-solid fa-code" style="color:#10b981"></i> Lab 1: XSS Reflected</h2>';
                    
                    // Tutorial Box
                    html += '<div class="tutorial-box">';
                    html += '<div class="tutorial-header">';
                    html += '<i class="fa-solid fa-circle-info"></i>';
                    html += '<h3>Qu\'est-ce que le XSS Reflected ?</h3>';
                    html += '<button class="hint-btn" onclick="toggleHint(\'xss-hint\')">Aide</button>';
                    html += '</div>';
                    html += '<p>Le XSS Reflected (ou non-persistant) se produit lorsque des données non fiables sont incluses dans la réponse d\'une application sans être correctement validées ou échappées.</p>';
                    html += '<div id="xss-hint" class="hint-content">';
                    html += '<p><strong>Indice :</strong> Essayez d\'injecter une balise script qui exécute <code>alert(1)</code>.</p>';
                    html += '<p><strong>Solution :</strong> <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> ou <code>&lt;img src=x onerror=alert(1)&gt;</code></p>';
                    html += '</div>';
                    html += '</div>';
                    
                    html += '<div class="stat-card" style="margin-bottom: 2rem;">';
                    html += '<h3 style="color: white; margin-bottom: 0.5rem;">Mission : Hackez cette recherche</h3>';
                    html += '<p style="color: #cbd5e1; line-height: 1.6;">Injectez du code JavaScript pour faire apparaître une <code>alert(1)</code>.</p>';
                    html += '</div>';
                    html += '<div class="lab-container">';
                    html += '<div style="margin-bottom: 1rem; color: #cbd5e1;">http://vulnerable-search.com</div>';
                    html += '<div class="lab-browser"><div class="browser-bar"><div class="browser-dots"><div class="dot dot-red"></div><div class="dot dot-yellow"></div><div class="dot dot-green"></div></div><div class="url-bar">/search</div></div>';
                    // Modification ici pour utiliser la nouvelle classe de wrapper pour la flexibilité mobile
                    html += '<div class="browser-content"><h2 style="margin-bottom: 1.5rem; color: #1e293b;">Super Search</h2>';
                    html += '<div class="search-form-container"><input type="text" id="lab-input-xss" class="vulnerable-input" placeholder="Que cherchez-vous ?"><button onclick="runXSSLab()" class="vulnerable-btn">Go</button></div>';
                    html += '<div id="lab-result-xss" class="search-result"></div></div></div></div>';
                    html += '<button id="validate-btn-xss" class="action-btn" onclick="validateLab(\'module-xss\')" disabled>' + (isDone ? 'Validé' : 'À faire') + '</button>';

                    return html;
                }
            },
            // ... autres modules ...
        };

        // Fonction pour gérer le menu mobile
        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            // Ferme également la sidebar au clic d'un lien pour améliorer l'UX mobile
            sidebar.classList.toggle('mobile-open');
        }

        // Modifie la fonction navigateTo pour fermer la sidebar sur mobile
        function navigateTo(view) {
            // ... (votre logique de navigation) ...
            
            // Ferme la sidebar si elle est ouverte (uniquement pertinent sur mobile)
            var sidebar = document.getElementById('sidebar');
            if (sidebar.classList.contains('mobile-open')) {
                sidebar.classList.remove('mobile-open');
            }

            // ... (suite de votre logique de navigation) ...
            appState.currentView = view;
            document.getElementById('content-area').innerHTML = modules[view].render();

            // Mise à jour des boutons actifs
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.nav-btn[data-view="${view}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }
        
        // Fonction runXSSLab - Doit être ajustée pour le nouvel HTML
        function runXSSLab() {
            var input = document.getElementById('lab-input-xss').value;
            var resultDiv = document.getElementById('lab-result-xss');
            var validateBtn = document.getElementById('validate-btn-xss');

            // Logic Simulation (Vulnerable)
            var cleanInput = input; // No sanitization for demo

            resultDiv.style.display = 'block';
            // Injects input directly into the HTML (Vulnerability simulation)
            resultDiv.innerHTML = 'Résultat de la recherche pour : <span style="font-weight:bold; color:#1e293b;">' + cleanInput + '</span>';

            // Check for payload (simple alert(1) check)
            if (input.toLowerCase().includes('alert(1)')) {
                // Execute the malicious code (for lab purposes)
                try {
                    // Simulate XSS execution by creating and appending a script tag
                    var script = document.createElement('script');
                    script.innerHTML = cleanInput;
                    resultDiv.appendChild(script);
                    
                    // Show validation toast
                    showToast('XSS réussi ! Validez le module.');
                    validateBtn.disabled = false;
                    validateBtn.innerText = 'Valider le Lab 1 (+200 XP)';

                } catch (e) {
                    // If script execution fails (due to browser or strict CSP)
                    showToast('Erreur d\'exécution du script.', 'error');
                }
            } else {
                showToast('Pas de payload détecté.', 'info');
                validateBtn.disabled = true;
                validateBtn.innerText = 'À faire';
            }

            // Ensure the main result text is visible
            resultDiv.style.display = 'block';

            // IMPORTANT: If you want to actually *execute* the script, you need a different method
            // The simulation above attempts to execute but modern browsers block script injection into innerHTML
            // The purpose here is mostly illustrative.
        }

        // Placeholder for utility functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('i');
            const msg = document.getElementById('toast-message');

            msg.textContent = message;
            
            if (type === 'success') {
                icon.className = 'fa-solid fa-check-circle';
                icon.style.color = '#34d399';
                toast.style.borderLeftColor = '#10b981';
            } else if (type === 'error') {
                icon.className = 'fa-solid fa-circle-xmark';
                icon.style.color = '#ef4444';
                toast.style.borderLeftColor = '#ef4444';
            } else {
                icon.className = 'fa-solid fa-info-circle';
                icon.style.color = '#3b82f6';
                toast.style.borderLeftColor = '#3b82f6';
            }

            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function validateLab(module) {
            // ... (votre logique de validation) ...
            if (appState.completedModules.indexOf(module) === -1) {
                appState.completedModules.push(module);
                appState.xp += modules[module].xpReward;
                updateXPDisplay();
                showToast(`Module ${module.toUpperCase()} validé ! +${modules[module].xpReward} XP.`, 'success');
            }
            navigateTo('dashboard');
        }

        function toggleHint(id) {
            const hint = document.getElementById(id);
            if (hint.style.display === 'block') {
                hint.style.display = 'none';
            } else {
                hint.style.display = 'block';
            }
        }

        function closeFakeAlert() {
            document.getElementById('fake-alert-overlay').style.display = 'none';
        }

        function updateXPDisplay() {
            const totalXP = 3000;
            const percentage = (appState.xp / totalXP) * 100;
            document.getElementById('xp-bar').style.width = `${Math.min(percentage, 100)}%`;
            document.getElementById('current-xp').textContent = `${appState.xp} XP`;

            let levelName = 'Novice';
            if (appState.xp >= 1000) levelName = 'Intermédiaire';
            if (appState.xp >= 2000) levelName = 'Avancé';
            if (appState.xp >= 3000) levelName = 'Maître';
            document.getElementById('user-level').textContent = levelName;
        }


        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            navigateTo('dashboard');
            updateXPDisplay();
        });
    </script>
</body>
</html>

